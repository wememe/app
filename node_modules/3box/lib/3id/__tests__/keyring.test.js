"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var Keyring = require('../keyring');

var nacl = require('tweetnacl');

nacl.util = require('tweetnacl-util');
describe('Keyring', function () {
  var keyring1;
  var keyring2;
  var keyring3;
  var mnemonic = 'clay rubber drama brush salute cream nerve wear stuff sentence trade conduct';
  var publicKeys1 = {
    signingKey: '028aaa695fa16f2a2279e1de718d80e00f4f4ddf30fe8674bbdb9e1f11778c2f77',
    ethereumKey: '027422e4f0321f010fd6b763bac41db22dcbf3717c7a9762bd7d2b9ce302152060',
    asymEncryptionKey: 'wW1wkjQ7kaZiBvk4bhukQ15Idx6d31XKFpq/jeup5nc='
  };
  var signedData = {
    r: 'b1f9c552e21b40fe95c5d3074a4ef3948a092a77fc814781bf8ae3a263499e0a',
    s: 'a57bdeb64a1490c3e8877d2d6e0c0450a87b765d8bf6f541b65bbf3aac1926f2',
    recoveryParam: 1 //const keyring2 = new Keyring()
    //const keyring3 = new Keyring()

  };
  it('throws error if no entropy or mnemonic',
  /*#__PURE__*/
  (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee() {
    return _regenerator.default.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            expect(function () {
              return new Keyring();
            }).toThrow();

          case 1:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, this);
  })));
  it('derives correct keys from entropy',
  /*#__PURE__*/
  (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee2() {
    return _regenerator.default.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            keyring2 = new Keyring({
              entropy: '0xf0e4c2f76c58916ec258f246851bea091d14d4247a2fc3e18694461b1816e13b'
            });
            keyring3 = new Keyring({
              entropy: '0x24a0bc3a2a1d1404c0ab24bef9bb0618938ee892fbf62f63f82f015eddf1729e'
            });
            expect(keyring2.mnemonic).toEqual('valley champion saddle suffer math resist annual bundle educate churn whisper banana spend head music echo sentence around pink method ranch arena lumber lemon');

          case 3:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2, this);
  })));
  it('derives correct keys from mnemonic',
  /*#__PURE__*/
  (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee3() {
    return _regenerator.default.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            keyring1 = new Keyring({
              mnemonic: mnemonic
            });
            expect(keyring1.getPublicKeys()).toEqual(publicKeys1);
            expect(keyring1.serialize()).toEqual(JSON.stringify({
              mnemonic: mnemonic
            }));

          case 3:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3, this);
  })));
  it('signs data correctly',
  /*#__PURE__*/
  (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee4() {
    return _regenerator.default.wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            _context4.t0 = expect;
            _context4.next = 3;
            return keyring1.getJWTSigner()('asdf');

          case 3:
            _context4.t1 = _context4.sent;
            _context4.t2 = signedData;
            (0, _context4.t0)(_context4.t1).toEqual(_context4.t2);

          case 6:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4, this);
  })));
  it('encrypts and decrypts correctly', function () {
    var testMsg = "Very secret test message";
    var box = keyring1.asymEncrypt(testMsg, keyring2.getPublicKeys().asymEncryptionKey);
    var cleartext = keyring2.asymDecrypt(box.ciphertext, keyring1.getPublicKeys().asymEncryptionKey, box.nonce);
    expect(cleartext).toEqual(testMsg);
  });
  it('symmetrically encrypts correctly',
  /*#__PURE__*/
  (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee5() {
    var testMsg, box, cleartext;
    return _regenerator.default.wrap(function _callee5$(_context5) {
      while (1) {
        switch (_context5.prev = _context5.next) {
          case 0:
            testMsg = "Very secret test message";
            box = keyring2.symEncrypt(testMsg);
            cleartext = keyring2.symDecrypt(box.ciphertext, box.nonce);
            expect(cleartext).toEqual(testMsg);

          case 4:
          case "end":
            return _context5.stop();
        }
      }
    }, _callee5, this);
  })));
});