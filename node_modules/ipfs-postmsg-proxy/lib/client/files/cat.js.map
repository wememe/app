{"version":3,"sources":["../../../src/client/files/cat.js"],"names":["opts","api","cat","callbackify","variadic","bufferFromJson","catReadableStream","toStream","source","catPullStream","arguments","res","PMS","name","Object","assign","post","data","deferred","defer","then","resolve","catch","err","abort"],"mappings":";;;;;;kBASe,UAAUA,IAAV,EAAgB;AAC7B,MAAMC,MAAM;AACVC,SAAKC,sBAAYC,QAAZ,CACH,kBACE,6BAAgB,CAAhB,CADF,EAEE,uBAAa,CAAb,CAFF,EAGE,mBACE,wBAAO,gBAAP,EAAyBJ,IAAzB,CADF,EAEEK,sBAFF,CAHF,CADG,CADK;AAWVC,qBAXU,+BAWW;AACnB,aAAOC,6BAASC,MAAT,CAAgBP,IAAIQ,aAAJ,YAAqBC,SAArB,CAAhB,CAAP;AACD,KAbS;;AAcVD,mBAAgB,YAAM;AACpB,UAAMA,gBAAgB,kBACpB,6BAAgB,CAAhB,CADoB,EAEpB,uBAAa,CAAb,CAFoB,EAGpB,mBACE,wBAAO,0BAAP,EAAmCT,IAAnC,CADF,EAEE,UAACW,GAAD;AAAA,eAASC,4BAAIJ,MAAJ,CAAWG,IAAIE,IAAf,EAAqBC,OAAOC,MAAP,CAAc,EAAd,EAAkBf,IAAlB,EAAwB;AACpDgB,cADoD,gBAC9CL,GAD8C,EACzC;AACT,gBAAI,0BAAaA,IAAIM,IAAjB,CAAJ,EAA4B;AAC1BN,kBAAIM,IAAJ,GAAW,4BAAeN,IAAIM,IAAnB,CAAX;AACD;;AAED,mBAAON,GAAP;AACD;AAPmD,SAAxB,CAArB,CAAT;AAAA,OAFF,CAHoB,CAAtB;;AAiBA,aAAO,YAAa;AAClB,YAAMO,WAAWC,oBAAMX,MAAN,EAAjB;;AAEAC,kDACGW,IADH,CACQ,UAACT,GAAD;AAAA,iBAASO,SAASG,OAAT,CAAiBV,GAAjB,CAAT;AAAA,SADR,EAEGW,KAFH,CAES,UAACC,GAAD;AAAA,iBAASL,SAASM,KAAT,CAAeD,GAAf,CAAT;AAAA,SAFT;;AAIA,eAAOL,QAAP;AACD,OARD;AASD,KA3Bc;AAdL,GAAZ;;AA4CA,SAAOjB,GAAP;AACD,C;;AAvDD;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA","file":"cat.js","sourcesContent":["import { caller } from 'postmsg-rpc'\nimport callbackify from 'callbackify'\nimport defer from 'pull-defer'\nimport toStream from 'pull-stream-to-stream'\nimport PMS from 'pull-postmsg-stream'\nimport { pre, post } from 'prepost'\nimport { preCidToJson } from '../../serialization/cid'\nimport { isBufferJson, preBufferToJson, bufferFromJson } from '../../serialization/buffer'\n\nexport default function (opts) {\n  const api = {\n    cat: callbackify.variadic(\n      pre(\n        preBufferToJson(0),\n        preCidToJson(0),\n        post(\n          caller('ipfs.files.cat', opts),\n          bufferFromJson\n        )\n      )\n    ),\n    catReadableStream () {\n      return toStream.source(api.catPullStream(...arguments))\n    },\n    catPullStream: (() => {\n      const catPullStream = pre(\n        preBufferToJson(0),\n        preCidToJson(0),\n        post(\n          caller('ipfs.files.catPullStream', opts),\n          (res) => PMS.source(res.name, Object.assign({}, opts, {\n            post (res) {\n              if (isBufferJson(res.data)) {\n                res.data = bufferFromJson(res.data)\n              }\n\n              return res\n            }\n          }))\n        )\n      )\n\n      return (...args) => {\n        const deferred = defer.source()\n\n        catPullStream(...args)\n          .then((res) => deferred.resolve(res))\n          .catch((err) => deferred.abort(err))\n\n        return deferred\n      }\n    })()\n  }\n\n  return api\n}\n"]}