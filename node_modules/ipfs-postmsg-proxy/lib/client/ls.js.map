{"version":3,"sources":["../../src/client/ls.js"],"names":["opts","api","ls","callbackify","variadic","lsReadableStream","toStream","source","lsPullStream","arguments","res","PMS","name","deferred","defer","then","resolve","catch","err","abort"],"mappings":";;;;;;kBASe,UAAUA,IAAV,EAAgB;AAC7B,MAAMC,MAAM;AACVC,QAAIC,sBAAYC,QAAZ,CACF,kBACE,6BAAgB,CAAhB,CADF,EAEE,uBAAa,CAAb,CAFF,EAGE,wBAAO,SAAP,EAAkBJ,IAAlB,CAHF,CADE,CADM;AAQVK,oBARU,8BAQU;AAClB,aAAOC,6BAASC,MAAT,CAAgBN,IAAIO,YAAJ,YAAoBC,SAApB,CAAhB,CAAP;AACD,KAVS;;AAWVD,kBAAe,YAAM;AACnB,UAAMA,eAAe,kBACnB,6BAAgB,CAAhB,CADmB,EAEnB,uBAAa,CAAb,CAFmB,EAGnB,mBACE,wBAAO,mBAAP,EAA4BR,IAA5B,CADF,EAEE,UAACU,GAAD;AAAA,eAASC,4BAAIJ,MAAJ,CAAWG,IAAIE,IAAf,EAAqBZ,IAArB,CAAT;AAAA,OAFF,CAHmB,CAArB;;AASA,aAAO,YAAa;AAClB,YAAMa,WAAWC,oBAAMP,MAAN,EAAjB;;AAEAC,iDACGO,IADH,CACQ,UAACL,GAAD;AAAA,iBAASG,SAASG,OAAT,CAAiBN,GAAjB,CAAT;AAAA,SADR,EAEGO,KAFH,CAES,UAACC,GAAD;AAAA,iBAASL,SAASM,KAAT,CAAeD,GAAf,CAAT;AAAA,SAFT;;AAIA,eAAOL,QAAP;AACD,OARD;AASD,KAnBa;AAXJ,GAAZ;;AAiCA,SAAOZ,GAAP;AACD,C;;AA5CD;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA","file":"ls.js","sourcesContent":["import { caller } from 'postmsg-rpc'\nimport callbackify from 'callbackify'\nimport defer from 'pull-defer'\nimport toStream from 'pull-stream-to-stream'\nimport PMS from 'pull-postmsg-stream'\nimport { pre, post } from 'prepost'\nimport { preCidToJson } from '../serialization/cid'\nimport { preBufferToJson } from '../serialization/buffer'\n\nexport default function (opts) {\n  const api = {\n    ls: callbackify.variadic(\n      pre(\n        preBufferToJson(0),\n        preCidToJson(0),\n        caller('ipfs.ls', opts)\n      )\n    ),\n    lsReadableStream () {\n      return toStream.source(api.lsPullStream(...arguments))\n    },\n    lsPullStream: (() => {\n      const lsPullStream = pre(\n        preBufferToJson(0),\n        preCidToJson(0),\n        post(\n          caller('ipfs.lsPullStream', opts),\n          (res) => PMS.source(res.name, opts)\n        )\n      )\n\n      return (...args) => {\n        const deferred = defer.source()\n\n        lsPullStream(...args)\n          .then((res) => deferred.resolve(res))\n          .catch((err) => deferred.abort(err))\n\n        return deferred\n      }\n    })()\n  }\n\n  return api\n}\n"]}