{"version":3,"sources":["../../src/server/swarm.js"],"names":["getIpfs","opts","peers","pre","swarm","res","map","item","addr","peer","addrs","peerInfoToJson","localAddrs","multiaddrToJson","connect","disconnect"],"mappings":";;;;;;kBAMe,UAAUA,OAAV,EAAmBC,IAAnB,EAAyB;AACtC,SAAO;AACLC,WAAO,wBAAO,kBAAP,EAA2B,kBAChCD,KAAKE,GAAL,CAAS,aAAT,CADgC,EAEhC,mBACE;AAAA;;AAAA,aAAa,4BAAUC,KAAV,EAAgBF,KAAhB,iCAAb;AAAA,KADF,EAEE,UAACG,GAAD;AAAA,aAASA,IAAIC,GAAJ,CAAQ,UAACC,IAAD,EAAU;AACzBA,aAAKC,IAAL,GAAY,gCAAgBD,KAAKC,IAArB,CAAZ;AACA;AACA,YAAI,sBAAWD,KAAKE,IAAhB,CAAJ,EAA2B;AACzBF,eAAKE,IAAL,GAAY,0BAAeF,KAAKE,IAApB,CAAZ;AACD,SAFD,MAEO,IAAI,oBAASF,KAAKE,IAAd,CAAJ,EAAyB;AAC9BF,eAAKE,IAAL,GAAY,wBAAaF,KAAKE,IAAlB,CAAZ;AACD;AACD,eAAOF,IAAP;AACD,OATQ,CAAT;AAAA,KAFF,CAFgC,CAA3B,EAeJN,IAfI,CADF;AAiBLS,WAAO,wBAAO,kBAAP,EAA2B,kBAChCT,KAAKE,GAAL,CAAS,aAAT,CADgC,EAEhC,mBACE;AAAA,aAAMH,UAAUI,KAAV,CAAgBM,KAAhB,EAAN;AAAA,KADF,EAEE,UAACL,GAAD;AAAA,aAASA,IAAIC,GAAJ,CAAQK,oBAAR,CAAT;AAAA,KAFF,CAFgC,CAA3B,EAMJV,IANI,CAjBF;AAwBLW,gBAAY,wBAAO,uBAAP,EAAgC,kBAC1CX,KAAKE,GAAL,CAAS,kBAAT,CAD0C,EAE1C,mBACE;AAAA,aAAMH,UAAUI,KAAV,CAAgBQ,UAAhB,EAAN;AAAA,KADF,EAEE,UAACP,GAAD;AAAA,aAASA,IAAIC,GAAJ,CAAQO,0BAAR,CAAT;AAAA,KAFF,CAF0C,CAAhC,EAMTZ,IANS,CAxBP;AA+BLa,aAAS,wBAAO,oBAAP,EAA6B,kBACpC,+BAAkB,CAAlB,CADoC,EAEpC,qCAAqB,CAArB,CAFoC,EAGpCb,KAAKE,GAAL,CAAS,eAAT,CAHoC,EAIpC;AAAA;;AAAA,aAAa,6BAAUC,KAAV,EAAgBU,OAAhB,kCAAb;AAAA,KAJoC,CAA7B,EAKNb,IALM,CA/BJ;AAqCLc,gBAAY,wBAAO,uBAAP,EAAgC,kBAC1C,+BAAkB,CAAlB,CAD0C,EAE1C,qCAAqB,CAArB,CAF0C,EAG1Cd,KAAKE,GAAL,CAAS,kBAAT,CAH0C,EAI1C;AAAA;;AAAA,aAAa,6BAAUC,KAAV,EAAgBW,UAAhB,kCAAb;AAAA,KAJ0C,CAAhC,EAKTd,IALS;AArCP,GAAP;AA4CD,C;;AAnDD;;AACA;;AACA;;AACA;;AACA","file":"swarm.js","sourcesContent":["import { expose } from 'postmsg-rpc'\nimport { pre, post } from 'prepost'\nimport { peerInfoToJson, peerIdToJson, isPeerInfo, isPeerId } from '../serialization/peer'\nimport { preMultiaddrFromJson, multiaddrToJson } from '../serialization/multiaddr'\nimport { preBufferFromJson } from '../serialization/buffer'\n\nexport default function (getIpfs, opts) {\n  return {\n    peers: expose('ipfs.swarm.peers', pre(\n      opts.pre('swarm.peers'),\n      post(\n        (...args) => getIpfs().swarm.peers(...args),\n        (res) => res.map((item) => {\n          item.addr = multiaddrToJson(item.addr)\n          // https://github.com/ipfs/js-ipfs/issues/1248\n          if (isPeerInfo(item.peer)) {\n            item.peer = peerInfoToJson(item.peer)\n          } else if (isPeerId(item.peer)) {\n            item.peer = peerIdToJson(item.peer)\n          }\n          return item\n        })\n      )\n    ), opts),\n    addrs: expose('ipfs.swarm.addrs', pre(\n      opts.pre('swarm.addrs'),\n      post(\n        () => getIpfs().swarm.addrs(),\n        (res) => res.map(peerInfoToJson)\n      )\n    ), opts),\n    localAddrs: expose('ipfs.swarm.localAddrs', pre(\n      opts.pre('swarm.localAddrs'),\n      post(\n        () => getIpfs().swarm.localAddrs(),\n        (res) => res.map(multiaddrToJson)\n      )\n    ), opts),\n    connect: expose('ipfs.swarm.connect', pre(\n      preBufferFromJson(0),\n      preMultiaddrFromJson(0),\n      opts.pre('swarm.connect'),\n      (...args) => getIpfs().swarm.connect(...args)\n    ), opts),\n    disconnect: expose('ipfs.swarm.disconnect', pre(\n      preBufferFromJson(0),\n      preMultiaddrFromJson(0),\n      opts.pre('swarm.disconnect'),\n      (...args) => getIpfs().swarm.disconnect(...args)\n    ), opts)\n  }\n}\n"]}