{"version":3,"sources":["../../../src/server/files/cat.js"],"names":["getIpfs","opts","cat","pre","files","bufferToJson","catPullStream","res","Promise","resolve","readFnName","PMS","sink","Object","assign","post","data"],"mappings":";;;;;;kBASe,UAAUA,OAAV,EAAmBC,IAAnB,EAAyB;AACtC,SAAO;AACLC,SAAK,wBAAO,gBAAP,EAAyB,kBAC5B,+BAAkB,CAAlB,CAD4B,EAE5B,yBAAe,CAAf,CAF4B,EAG5BD,KAAKE,GAAL,CAAS,WAAT,CAH4B,EAI5B,mBACE;AAAA;;AAAA,aAAa,4BAAUC,KAAV,EAAgBF,GAAhB,iCAAb;AAAA,KADF,EAEEG,oBAFF,CAJ4B,CAAzB,EAQFJ,IARE,CADA;AAULK,mBAAe,wBAAO,0BAAP,EAAmC,kBAChD,+BAAkB,CAAlB,CADgD,EAEhD,yBAAe,CAAf,CAFgD,EAGhDL,KAAKE,GAAL,CAAS,qBAAT,CAHgD,EAIhD,mBACE;AAAA;;AAAA,aAAa,6BAAUC,KAAV,EAAgBE,aAAhB,kCAAb;AAAA,KADF,EAEE,UAACC,GAAD;AAAA,aAAS,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAChC,YAAMC,aAAa,wBAAnB;;AAEA,kCACEH,GADF,EAEEI,4BAAIC,IAAJ,CAASF,UAAT,EAAqBG,OAAOC,MAAP,CAAc,EAAd,EAAkBb,IAAlB,EAAwB;AAC3Cc,cAD2C,gBACrCR,GADqC,EAChC;AACT,gBAAI,sBAASA,IAAIS,IAAb,CAAJ,EAAwB;AACtBT,kBAAIS,IAAJ,GAAW,0BAAaT,IAAIS,IAAjB,CAAX;AACD;;AAED,mBAAOT,GAAP;AACD;AAP0C,SAAxB,CAArB,CAFF;;AAaAE,gBAAQ,8BAAeC,UAAf,CAAR;AACD,OAjBQ,CAAT;AAAA,KAFF,CAJgD,CAAnC,EAyBZT,IAzBY;AAVV,GAAP;AAqCD,C;;AA/CD;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA","file":"cat.js","sourcesContent":["import { expose } from 'postmsg-rpc'\nimport { pre, post } from 'prepost'\nimport pull from 'pull-stream'\nimport PMS from 'pull-postmsg-stream'\nimport shortid from 'shortid'\nimport { preCidFromJson } from '../../serialization/cid'\nimport { isBuffer, preBufferFromJson, bufferToJson } from '../../serialization/buffer'\nimport { functionToJson } from '../../serialization/function'\n\nexport default function (getIpfs, opts) {\n  return {\n    cat: expose('ipfs.files.cat', pre(\n      preBufferFromJson(0),\n      preCidFromJson(0),\n      opts.pre('files.cat'),\n      post(\n        (...args) => getIpfs().files.cat(...args),\n        bufferToJson\n      )\n    ), opts),\n    catPullStream: expose('ipfs.files.catPullStream', pre(\n      preBufferFromJson(0),\n      preCidFromJson(0),\n      opts.pre('files.catPullStream'),\n      post(\n        (...args) => getIpfs().files.catPullStream(...args),\n        (res) => new Promise((resolve) => {\n          const readFnName = shortid()\n\n          pull(\n            res,\n            PMS.sink(readFnName, Object.assign({}, opts, {\n              post (res) {\n                if (isBuffer(res.data)) {\n                  res.data = bufferToJson(res.data)\n                }\n\n                return res\n              }\n            }))\n          )\n\n          resolve(functionToJson(readFnName))\n        })\n      )\n    ), opts)\n  }\n}\n"]}