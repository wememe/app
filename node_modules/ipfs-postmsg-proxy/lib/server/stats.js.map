{"version":3,"sources":["../../src/server/stats.js"],"names":["getIpfs","opts","bw","pre","stats","totalIn","totalOut","rateIn","rateOut","bwPullStream","res","Promise","resolve","readFnName","PMS","sink","Object","assign","post","data"],"mappings":";;;;;;kBAQe,UAAUA,OAAV,EAAmBC,IAAnB,EAAyB;AACtC,SAAO;AACLC,QAAI,wBAAO,eAAP,EAAwB,kBAC1BD,KAAKE,GAAL,CAAS,UAAT,CAD0B,EAE1B,mBACE;AAAA;;AAAA,aAAa,4BAAUC,KAAV,EAAgBF,EAAhB,iCAAb;AAAA,KADF,EAEE,UAACE,KAAD,EAAW;AACT,UAAIA,KAAJ,EAAW;AACT,YAAI,gBAAMA,MAAMC,OAAZ,CAAJ,EAA0B;AACxBD,gBAAMC,OAAN,GAAgB,oBAAUD,MAAMC,OAAhB,CAAhB;AACD;;AAED,YAAI,gBAAMD,MAAME,QAAZ,CAAJ,EAA2B;AACzBF,gBAAME,QAAN,GAAiB,oBAAUF,MAAME,QAAhB,CAAjB;AACD;;AAED,YAAI,gBAAMF,MAAMG,MAAZ,CAAJ,EAAyB;AACvBH,gBAAMG,MAAN,GAAe,oBAAUH,MAAMG,MAAhB,CAAf;AACD;;AAED,YAAI,gBAAMH,MAAMI,OAAZ,CAAJ,EAA0B;AACxBJ,gBAAMI,OAAN,GAAgB,oBAAUJ,MAAMI,OAAhB,CAAhB;AACD;AACF;;AAED,aAAOJ,KAAP;AACD,KAtBH,CAF0B,CAAxB,EA0BDH,IA1BC,CADC;AA4BLQ,kBAAc,wBAAO,yBAAP,EAAkC,kBAC9CR,KAAKE,GAAL,CAAS,oBAAT,CAD8C,EAE9C,mBACE;AAAA;;AAAA,aAAa,6BAAUC,KAAV,EAAgBK,YAAhB,kCAAb;AAAA,KADF,EAEE,UAACC,GAAD;AAAA,aAAS,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAChC,YAAMC,aAAa,wBAAnB;;AAEA,kCACEH,GADF,EAEEI,4BAAIC,IAAJ,CAASF,UAAT,EAAqBG,OAAOC,MAAP,CAAc,EAAd,EAAkBhB,IAAlB,EAAwB;AAC3CiB,cAD2C,gBACrCR,GADqC,EAChC;AACT,gBAAMN,QAAQM,IAAIS,IAAlB;;AAEA,gBAAIf,KAAJ,EAAW;AACT,kBAAI,gBAAMA,MAAMC,OAAZ,CAAJ,EAA0B;AACxBD,sBAAMC,OAAN,GAAgB,oBAAUD,MAAMC,OAAhB,CAAhB;AACD;;AAED,kBAAI,gBAAMD,MAAME,QAAZ,CAAJ,EAA2B;AACzBF,sBAAME,QAAN,GAAiB,oBAAUF,MAAME,QAAhB,CAAjB;AACD;;AAED,kBAAI,gBAAMF,MAAMG,MAAZ,CAAJ,EAAyB;AACvBH,sBAAMG,MAAN,GAAe,oBAAUH,MAAMG,MAAhB,CAAf;AACD;;AAED,kBAAI,gBAAMH,MAAMI,OAAZ,CAAJ,EAA0B;AACxBJ,sBAAMI,OAAN,GAAgB,oBAAUJ,MAAMI,OAAhB,CAAhB;AACD;AACF;;AAED,mBAAOE,GAAP;AACD;AAvB0C,SAAxB,CAArB,CAFF;;AA6BAE,gBAAQ,8BAAeC,UAAf,CAAR;AACD,OAjCQ,CAAT;AAAA,KAFF,CAF8C,CAAlC,EAuCXZ,IAvCW;AA5BT,GAAP;AAqED,C;;AA9ED;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA","file":"stats.js","sourcesContent":["import { expose } from 'postmsg-rpc'\nimport { pre, post } from 'prepost'\nimport shortid from 'shortid'\nimport pull from 'pull-stream'\nimport PMS from 'pull-postmsg-stream'\nimport { isBig, bigToJson } from '../serialization/big'\nimport { functionToJson } from '../serialization/function'\n\nexport default function (getIpfs, opts) {\n  return {\n    bw: expose('ipfs.stats.bw', pre(\n      opts.pre('stats.bw'),\n      post(\n        (...args) => getIpfs().stats.bw(...args),\n        (stats) => {\n          if (stats) {\n            if (isBig(stats.totalIn)) {\n              stats.totalIn = bigToJson(stats.totalIn)\n            }\n\n            if (isBig(stats.totalOut)) {\n              stats.totalOut = bigToJson(stats.totalOut)\n            }\n\n            if (isBig(stats.rateIn)) {\n              stats.rateIn = bigToJson(stats.rateIn)\n            }\n\n            if (isBig(stats.rateOut)) {\n              stats.rateOut = bigToJson(stats.rateOut)\n            }\n          }\n\n          return stats\n        }\n      )\n    ), opts),\n    bwPullStream: expose('ipfs.stats.bwPullStream', pre(\n      opts.pre('stats.bwPullStream'),\n      post(\n        (...args) => getIpfs().stats.bwPullStream(...args),\n        (res) => new Promise((resolve) => {\n          const readFnName = shortid()\n\n          pull(\n            res,\n            PMS.sink(readFnName, Object.assign({}, opts, {\n              post (res) {\n                const stats = res.data\n\n                if (stats) {\n                  if (isBig(stats.totalIn)) {\n                    stats.totalIn = bigToJson(stats.totalIn)\n                  }\n\n                  if (isBig(stats.totalOut)) {\n                    stats.totalOut = bigToJson(stats.totalOut)\n                  }\n\n                  if (isBig(stats.rateIn)) {\n                    stats.rateIn = bigToJson(stats.rateIn)\n                  }\n\n                  if (isBig(stats.rateOut)) {\n                    stats.rateOut = bigToJson(stats.rateOut)\n                  }\n                }\n\n                return res\n              }\n            }))\n          )\n\n          resolve(functionToJson(readFnName))\n        })\n      )\n    ), opts)\n  }\n}\n"]}