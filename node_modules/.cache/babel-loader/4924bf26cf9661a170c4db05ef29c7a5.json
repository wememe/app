{"ast":null,"code":"'use strict';\n\nvar pull = require('pull-stream');\n\nvar cat = require('pull-cat'); // Logic to export a unixfs directory.\n\n\nmodule.exports = shardedDirExporter;\n\nfunction shardedDirExporter(cid, node, name, path, pathRest, resolve, size, dag, parent, depth) {\n  var dir;\n\n  if (!parent || parent.path !== path) {\n    dir = {\n      name: name,\n      depth: depth,\n      path: path,\n      hash: cid,\n      size: node.size,\n      type: 'dir'\n    };\n  }\n\n  var streams = [pull(pull.values(node.links), pull.map(function (link) {\n    // remove the link prefix (2 chars for the bucket index)\n    var p = link.name.substring(2);\n    var pp = p ? path + '/' + p : path;\n    var accept = true;\n\n    if (p && pathRest.length) {\n      accept = p === pathRest[0];\n    }\n\n    if (accept) {\n      return {\n        depth: depth + 1,\n        name: p,\n        path: pp,\n        multihash: link.multihash,\n        pathRest: p ? pathRest.slice(1) : pathRest,\n        parent: dir || parent\n      };\n    } else {\n      return '';\n    }\n  }), pull.filter(Boolean), resolve)];\n\n  if (!pathRest.length) {\n    streams.unshift(pull.values([dir]));\n  }\n\n  return cat(streams);\n}","map":null,"metadata":{},"sourceType":"script"}