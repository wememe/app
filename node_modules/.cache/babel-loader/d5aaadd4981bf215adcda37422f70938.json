{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar setImmediate = require('async/setImmediate');\n\nvar EE = require('events').EventEmitter;\n\nvar Connection = require('interface-connection').Connection;\n\nvar utilsFactory = require('./utils');\n\nvar PeerInfo = require('peer-info');\n\nvar proto = require('../protocol').CircuitRelay;\n\nvar series = require('async/series');\n\nvar debug = require('debug');\n\nvar log = debug('libp2p:circuit:stop');\nlog.err = debug('libp2p:circuit:error:stop');\n\nvar Stop =\n/*#__PURE__*/\nfunction (_EE) {\n  _inherits(Stop, _EE);\n\n  function Stop(swarm) {\n    var _this;\n\n    _classCallCheck(this, Stop);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Stop).call(this));\n    _this.swarm = swarm;\n    _this.utils = utilsFactory(swarm);\n    return _this;\n  }\n  /**\n   * Handle the incoming STOP message\n   *\n   * @param {{}} msg  - the parsed protobuf message\n   * @param {StreamHandler} sh  - the stream handler wrapped connection\n   * @param {Function} callback  - callback\n   * @returns {undefined}\n   */\n\n\n  _createClass(Stop, [{\n    key: \"handle\",\n    value: function handle(msg, sh, callback) {\n      var _this2 = this;\n\n      callback = callback || function () {};\n\n      series([function (cb) {\n        return _this2.utils.validateAddrs(msg, sh, proto.Type.STOP, cb);\n      }, function (cb) {\n        return _this2.utils.writeResponse(sh, proto.Status.Success, cb);\n      }], function (err) {\n        if (err) {\n          // we don't return the error here,\n          // since multistream select don't expect one\n          callback();\n          return log(err);\n        }\n\n        var peerInfo = new PeerInfo(_this2.utils.peerIdFromId(msg.srcPeer.id));\n        msg.srcPeer.addrs.forEach(function (addr) {\n          return peerInfo.multiaddrs.add(addr);\n        });\n        var newConn = new Connection(sh.rest());\n        newConn.setPeerInfo(peerInfo);\n        setImmediate(function () {\n          return _this2.emit('connection', newConn);\n        });\n        callback(newConn);\n      });\n    }\n  }]);\n\n  return Stop;\n}(EE);\n\nmodule.exports = Stop;","map":null,"metadata":{},"sourceType":"script"}