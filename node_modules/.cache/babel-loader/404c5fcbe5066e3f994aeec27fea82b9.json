{"ast":null,"code":"/* global FileReader */\nvar from2 = require('from2');\n\nvar toBuffer = require('typedarray-to-buffer');\n\nmodule.exports = function (file, options) {\n  options = options || {};\n  var offset = options.offset || 0;\n  var chunkSize = options.chunkSize || 1024 * 1024; // default 1MB chunk has tolerable perf on large files\n\n  var fileReader = new FileReader(file);\n  var from = from2(function (size, cb) {\n    if (offset >= file.size) return cb(null, null);\n\n    fileReader.onloadend = function loaded(event) {\n      var data = event.target.result;\n      if (data instanceof ArrayBuffer) data = toBuffer(new Uint8Array(event.target.result));\n      cb(null, data);\n    };\n\n    var end = offset + chunkSize;\n    var slice = file.slice(offset, end);\n    fileReader.readAsArrayBuffer(slice);\n    offset = end;\n  });\n  from.name = file.name;\n  from.size = file.size;\n  from.type = file.type;\n  from.lastModified = file.lastModified;\n\n  fileReader.onerror = function (err) {\n    from.destroy(err);\n  };\n\n  return from;\n};","map":null,"metadata":{},"sourceType":"script"}