{"ast":null,"code":"'use strict';\n\nvar handshake = require('pull-handshake');\n\nvar pullLP = require('pull-length-prefixed');\n\nvar util = require('./util');\n\nvar writeEncoded = util.writeEncoded;\n\nfunction select(multicodec, callback, log) {\n  var stream = handshake({\n    timeout: 60 * 1000\n  }, callback);\n  var shake = stream.handshake;\n  log('writing multicodec: ' + multicodec);\n  writeEncoded(shake, Buffer.from(multicodec + '\\n'), callback);\n  pullLP.decodeFromReader(shake, function (err, data) {\n    if (err) {\n      return callback(err);\n    }\n\n    var protocol = data.toString().slice(0, -1);\n\n    if (protocol !== multicodec) {\n      return callback(new Error(\"\\\"\".concat(multicodec, \"\\\" not supported\")), shake.rest());\n    }\n\n    log('received ack: ' + protocol);\n    callback(null, shake.rest());\n  });\n  return stream;\n}\n\nmodule.exports = select;","map":null,"metadata":{},"sourceType":"script"}