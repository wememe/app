{"ast":null,"code":"'use strict';\n\nvar pull = require('pull-stream/pull');\n\nvar handshake = require('pull-handshake');\n\nvar constants = require('./constants');\n\nvar PROTOCOL = constants.PROTOCOL;\nvar PING_LENGTH = constants.PING_LENGTH;\n\nvar debug = require('debug');\n\nvar log = debug('libp2p-ping');\nlog.error = debug('libp2p-ping:error');\n\nfunction mount(swarm) {\n  swarm.handle(PROTOCOL, function (protocol, conn) {\n    var stream = handshake({\n      timeout: 0\n    });\n    var shake = stream.handshake; // receive and echo back\n\n    function next() {\n      shake.read(PING_LENGTH, function (err, buf) {\n        if (err === true) {\n          // stream closed\n          return;\n        }\n\n        if (err) {\n          return log.error(err);\n        }\n\n        shake.write(buf);\n        return next();\n      });\n    }\n\n    pull(conn, stream, conn);\n    next();\n  });\n}\n\nfunction unmount(swarm) {\n  swarm.unhandle(PROTOCOL);\n}\n\nexports = module.exports;\nexports.mount = mount;\nexports.unmount = unmount;","map":null,"metadata":{},"sourceType":"script"}