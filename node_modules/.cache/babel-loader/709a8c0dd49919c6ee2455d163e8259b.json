{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar asyncEachSeries = require('async/eachSeries');\n\nvar waterfall = require('async/waterfall');\n\nvar CID = require('cids');\n\nvar dagPB = require('ipld-dag-pb');\n\nvar UnixFS = require('ipfs-unixfs');\n\nvar DAGLink = dagPB.DAGLink;\nvar DAGNode = dagPB.DAGNode;\n\nvar Dir = require('./dir');\n\nvar DirFlat =\n/*#__PURE__*/\nfunction (_Dir) {\n  _inherits(DirFlat, _Dir);\n\n  function DirFlat(props, _options) {\n    var _this;\n\n    _classCallCheck(this, DirFlat);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DirFlat).call(this, props, _options));\n    _this._children = {};\n    return _this;\n  }\n\n  _createClass(DirFlat, [{\n    key: \"put\",\n    value: function put(name, value, callback) {\n      this.multihash = undefined;\n      this.size = undefined;\n      this._children[name] = value;\n      process.nextTick(callback);\n    }\n  }, {\n    key: \"get\",\n    value: function get(name, callback) {\n      var _this2 = this;\n\n      process.nextTick(function () {\n        return callback(null, _this2._children[name]);\n      });\n    }\n  }, {\n    key: \"childCount\",\n    value: function childCount() {\n      return Object.keys(this._children).length;\n    }\n  }, {\n    key: \"directChildrenCount\",\n    value: function directChildrenCount() {\n      return this.childCount();\n    }\n  }, {\n    key: \"onlyChild\",\n    value: function onlyChild(callback) {\n      var _this3 = this;\n\n      process.nextTick(function () {\n        return callback(null, _this3._children[Object.keys(_this3._children)[0]]);\n      });\n    }\n  }, {\n    key: \"eachChildSeries\",\n    value: function eachChildSeries(iterator, callback) {\n      var _this4 = this;\n\n      asyncEachSeries(Object.keys(this._children), function (key, callback) {\n        iterator(key, _this4._children[key], callback);\n      }, callback);\n    }\n  }, {\n    key: \"flush\",\n    value: function flush(path, ipld, source, callback) {\n      var _this5 = this;\n\n      var links = Object.keys(this._children).map(function (key) {\n        var child = _this5._children[key];\n        return new DAGLink(key, child.size, child.multihash);\n      });\n      var dir = new UnixFS('directory');\n      var options = this._options;\n      waterfall([function (callback) {\n        return DAGNode.create(dir.marshal(), links, options.hashAlg, callback);\n      }, function (node, callback) {\n        if (options.onlyHash) return callback(null, node);\n        var cid = new CID(node.multihash);\n\n        if (options.cidVersion === 1) {\n          cid = cid.toV1();\n        }\n\n        ipld.put(node, {\n          cid: cid\n        }, function (err) {\n          return callback(err, node);\n        });\n      }, function (node, callback) {\n        _this5.multihash = node.multihash;\n        _this5.size = node.size;\n        var pushable = {\n          path: path,\n          multihash: node.multihash,\n          size: node.size\n        };\n        source.push(pushable);\n        callback(null, node);\n      }], callback);\n    }\n  }]);\n\n  return DirFlat;\n}(Dir);\n\nmodule.exports = createDirFlat;\n\nfunction createDirFlat(props, _options) {\n  return new DirFlat(props, _options);\n}","map":null,"metadata":{},"sourceType":"script"}