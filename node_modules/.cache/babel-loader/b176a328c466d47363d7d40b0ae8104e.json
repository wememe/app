{"ast":null,"code":"module.exports = function () {\n  var buffers = [],\n      length = 0; //just used for debugging...\n\n  function calcLength() {\n    return buffers.reduce(function (a, b) {\n      return a + b.length;\n    }, 0);\n  }\n\n  return {\n    length: length,\n    data: this,\n    add: function add(data) {\n      if (!Buffer.isBuffer(data)) throw new Error('data must be a buffer, was: ' + JSON.stringify(data));\n      this.length = length = length + data.length;\n      buffers.push(data);\n      return this;\n    },\n    has: function has(n) {\n      if (null == n) return length > 0;\n      return length >= n;\n    },\n    get: function get(n) {\n      var _length;\n\n      if (n == null || n === length) {\n        length = 0;\n        var _buffers = buffers;\n        buffers = [];\n        if (_buffers.length == 1) return _buffers[0];else return Buffer.concat(_buffers);\n      } else if (buffers.length > 1 && n <= (_length = buffers[0].length)) {\n        var buf = buffers[0].slice(0, n);\n\n        if (n === _length) {\n          buffers.shift();\n        } else {\n          buffers[0] = buffers[0].slice(n, _length);\n        }\n\n        length -= n;\n        return buf;\n      } else if (n < length) {\n        var out = [],\n            len = 0;\n\n        while (len + buffers[0].length < n) {\n          var b = buffers.shift();\n          len += b.length;\n          out.push(b);\n        }\n\n        if (len < n) {\n          out.push(buffers[0].slice(0, n - len));\n          buffers[0] = buffers[0].slice(n - len, buffers[0].length);\n          this.length = length = length - n;\n        }\n\n        return Buffer.concat(out);\n      } else throw new Error('could not get ' + n + ' bytes');\n    }\n  };\n};","map":null,"metadata":{},"sourceType":"script"}