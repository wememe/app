{"ast":null,"code":"/* Copyright (c) 2017 Rod Vagg, MIT License */\nfunction AbstractChainedBatch(db) {\n  this._db = db;\n  this._operations = [];\n  this._written = false;\n}\n\nAbstractChainedBatch.prototype._serializeKey = function (key) {\n  return this._db._serializeKey(key);\n};\n\nAbstractChainedBatch.prototype._serializeValue = function (value) {\n  return this._db._serializeValue(value);\n};\n\nAbstractChainedBatch.prototype._checkWritten = function () {\n  if (this._written) {\n    throw new Error('write() already called on this batch');\n  }\n};\n\nAbstractChainedBatch.prototype.put = function (key, value) {\n  this._checkWritten();\n\n  var err = this._db._checkKey(key, 'key');\n\n  if (err) {\n    throw err;\n  }\n\n  key = this._serializeKey(key);\n  value = this._serializeValue(value);\n\n  this._put(key, value);\n\n  return this;\n};\n\nAbstractChainedBatch.prototype._put = function (key, value) {\n  this._operations.push({\n    type: 'put',\n    key: key,\n    value: value\n  });\n};\n\nAbstractChainedBatch.prototype.del = function (key) {\n  this._checkWritten();\n\n  var err = this._db._checkKey(key, 'key');\n\n  if (err) {\n    throw err;\n  }\n\n  key = this._serializeKey(key);\n\n  this._del(key);\n\n  return this;\n};\n\nAbstractChainedBatch.prototype._del = function (key) {\n  this._operations.push({\n    type: 'del',\n    key: key\n  });\n};\n\nAbstractChainedBatch.prototype.clear = function () {\n  this._checkWritten();\n\n  this._operations = [];\n\n  this._clear();\n\n  return this;\n};\n\nAbstractChainedBatch.prototype._clear = function noop() {};\n\nAbstractChainedBatch.prototype.write = function (options, callback) {\n  this._checkWritten();\n\n  if (typeof options === 'function') {\n    callback = options;\n  }\n\n  if (typeof callback !== 'function') {\n    throw new Error('write() requires a callback argument');\n  }\n\n  if (typeof options !== 'object') {\n    options = {};\n  }\n\n  this._written = true; // @ts-ignore\n\n  if (typeof this._write === 'function') {\n    return this._write(callback);\n  }\n\n  if (typeof this._db._batch === 'function') {\n    return this._db._batch(this._operations, options, callback);\n  }\n\n  process.nextTick(callback);\n};\n\nmodule.exports = AbstractChainedBatch;","map":null,"metadata":{},"sourceType":"script"}