{"ast":null,"code":"var Reader = require('pull-reader');\n\nvar Writer = require('pull-pushable');\n\nvar cat = require('pull-cat');\n\nvar pair = require('pull-pair');\n\nfunction once(cb) {\n  var called = 0;\n  return function (a, b, c) {\n    if (called++) return;\n    cb(a, b, c);\n  };\n}\n\nfunction isFunction(f) {\n  return 'function' === typeof f;\n}\n\nmodule.exports = function (opts, _cb) {\n  if (isFunction(opts)) _cb = opts, opts = {};\n  _cb = once(_cb || function noop() {});\n  var reader = Reader(opts && opts.timeout || 5e3);\n  var writer = Writer(function (err) {\n    if (err) _cb(err);\n  });\n  var p = pair();\n  return {\n    handshake: {\n      read: reader.read,\n      abort: function abort(err) {\n        writer.end(err);\n        reader.abort(err, function (err) {});\n\n        _cb(err);\n      },\n      write: writer.push,\n      rest: function rest() {\n        writer.end();\n        return {\n          source: reader.read(),\n          sink: p.sink\n        };\n      }\n    },\n    sink: reader,\n    source: cat([writer, p.source])\n  };\n};","map":null,"metadata":{},"sourceType":"script"}