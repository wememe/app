{"ast":null,"code":"'use strict';\n\nvar promisify = require('promisify-es6');\n\nvar setImmediate = require('async/setImmediate');\n\nmodule.exports = function pubsub(self) {\n  return {\n    subscribe: function subscribe(topic, handler, options, callback) {\n      if (typeof options === 'function') {\n        callback = options;\n        options = {};\n      }\n\n      if (!callback) {\n        return new Promise(function (resolve, reject) {\n          self._libp2pNode.pubsub.subscribe(topic, options, handler, function (err) {\n            if (err) {\n              return reject(err);\n            }\n\n            resolve();\n          });\n        });\n      }\n\n      self._libp2pNode.pubsub.subscribe(topic, options, handler, callback);\n    },\n    unsubscribe: function unsubscribe(topic, handler, callback) {\n      self._libp2pNode.pubsub.unsubscribe(topic, handler);\n\n      if (!callback) {\n        return Promise.resolve();\n      }\n\n      setImmediate(function () {\n        return callback();\n      });\n    },\n    publish: promisify(function (topic, data, callback) {\n      self._libp2pNode.pubsub.publish(topic, data, callback);\n    }),\n    ls: promisify(function (callback) {\n      self._libp2pNode.pubsub.ls(callback);\n    }),\n    peers: promisify(function (topic, callback) {\n      self._libp2pNode.pubsub.peers(topic, callback);\n    }),\n    setMaxListeners: function setMaxListeners(n) {\n      self._libp2pNode.pubsub.setMaxListeners(n);\n    }\n  };\n};","map":null,"metadata":{},"sourceType":"script"}