{"ast":null,"code":"'use strict'; //load websocket library if we are not in the browser\n\nvar WebSocket = require('./web-socket');\n\nvar duplex = require('./duplex');\n\nvar wsurl = require('./ws-url');\n\nfunction isFunction(f) {\n  return 'function' === typeof f;\n}\n\nmodule.exports = function (addr, opts) {\n  if (isFunction(opts)) opts = {\n    onConnect: opts\n  };\n  var location = typeof window === 'undefined' ? {} : window.location;\n  var url = wsurl(addr, location);\n  var socket = new WebSocket(url);\n  var stream = duplex(socket, opts);\n  stream.remoteAddress = url;\n\n  stream.close = function (cb) {\n    if (isFunction(cb)) {\n      socket.addEventListener('close', cb);\n    }\n\n    socket.close();\n  };\n\n  socket.addEventListener('open', function (e) {\n    if (opts && isFunction(opts.onConnect)) {\n      opts.onConnect(null, stream);\n    }\n  });\n  return stream;\n};\n\nmodule.exports.connect = module.exports;","map":null,"metadata":{},"sourceType":"script"}