{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/Users/kenzo/Desktop/3box-dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar Store = require('orbit-db-store');\n\nvar DocumentIndex = require('./DocumentIndex');\n\nvar pMap = require('p-map');\n\nvar Readable = require('readable-stream');\n\nvar replaceAll = function replaceAll(str, search, replacement) {\n  return str.toString().split(search).join(replacement);\n};\n\nvar DocumentStore =\n/*#__PURE__*/\nfunction (_Store) {\n  _inherits(DocumentStore, _Store);\n\n  function DocumentStore(ipfs, id, dbname, options) {\n    var _this;\n\n    _classCallCheck(this, DocumentStore);\n\n    if (!options) options = {};\n    if (!options.indexBy) Object.assign(options, {\n      indexBy: '_id'\n    });\n    if (!options.Index) Object.assign(options, {\n      Index: DocumentIndex\n    });\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DocumentStore).call(this, ipfs, id, dbname, options));\n    _this._type = 'docstore';\n    return _this;\n  }\n\n  _createClass(DocumentStore, [{\n    key: \"get\",\n    value: function get(key) {\n      var _this2 = this;\n\n      var caseSensitive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      key = key.toString();\n      var terms = key.split(' ');\n      key = terms.length > 1 ? replaceAll(key, '.', ' ').toLowerCase() : key.toLowerCase();\n\n      var search = function search(e) {\n        if (terms.length > 1) {\n          return replaceAll(e, '.', ' ').toLowerCase().indexOf(key) !== -1;\n        }\n\n        return e.toLowerCase().indexOf(key) !== -1;\n      };\n\n      var mapper = function mapper(e) {\n        return _this2._index.get(e);\n      };\n\n      var filter = function filter(e) {\n        return caseSensitive ? e.indexOf(key) !== -1 : search(e);\n      };\n\n      return Object.keys(this._index._index).filter(filter).map(mapper);\n    }\n  }, {\n    key: \"query\",\n    value: function query(mapper) {\n      var _this3 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      // Whether we return the full operation data or just the db value\n      var fullOp = options ? options.fullOp : false;\n      return Object.keys(this._index._index).map(function (e) {\n        return _this3._index.get(e, fullOp);\n      }).filter(mapper);\n    }\n  }, {\n    key: \"batchPut\",\n    value: function batchPut(docs, onProgressCallback) {\n      var _this4 = this;\n\n      var mapper = function mapper(doc, idx) {\n        return _this4._addOperationBatch({\n          op: 'PUT',\n          key: doc[_this4.options.indexBy],\n          value: doc\n        }, true, idx === docs.length - 1, onProgressCallback);\n      };\n\n      return pMap(docs, mapper, {\n        concurrency: 1\n      }).then(function () {\n        return _this4.saveSnapshot();\n      });\n    }\n  }, {\n    key: \"put\",\n    value: function put(doc) {\n      if (!doc[this.options.indexBy]) throw new Error(\"The provided document doesn't contain field '\".concat(this.options.indexBy, \"'\"));\n      return this._addOperation({\n        op: 'PUT',\n        key: doc[this.options.indexBy],\n        value: doc\n      });\n    }\n  }, {\n    key: \"del\",\n    value: function del(key) {\n      if (!this._index.get(key)) throw new Error(\"No entry with key '\".concat(key, \"' in the database\"));\n      return this._addOperation({\n        op: 'DEL',\n        key: key,\n        value: null\n      });\n    }\n  }]);\n\n  return DocumentStore;\n}(Store);\n\nmodule.exports = DocumentStore;","map":null,"metadata":{},"sourceType":"script"}