{"ast":null,"code":"'use strict';\n\nvar pull = require('pull-stream');\n\nvar Source = require('pull-defer/source');\n\nvar path = require('path');\n\nvar os = require('os');\n\nvar uuid = require('uuid/v4');\n\nexports.asyncFilter = function (test) {\n  var busy = false;\n  var abortCb;\n  var aborted;\n  return function (read) {\n    return function next(abort, cb) {\n      if (aborted) return cb(aborted);\n\n      if (abort) {\n        aborted = abort;\n\n        if (!busy) {\n          read(abort, cb);\n        } else {\n          read(abort, function () {\n            // if we are still busy, wait for the test to complete.\n            if (busy) abortCb = cb;else cb(abort);\n          });\n        }\n      } else {\n        read(null, function (end, data) {\n          if (end) cb(end);else if (aborted) cb(aborted);else {\n            busy = true;\n            test(data, function (err, valid) {\n              busy = false;\n\n              if (aborted) {\n                cb(aborted);\n                abortCb(aborted);\n              } else if (err) {\n                next(err, cb);\n              } else if (valid) {\n                cb(null, data);\n              } else {\n                next(null, cb);\n              }\n            });\n          }\n        });\n      }\n    };\n  };\n};\n\nexports.asyncSort = function (sorter) {\n  var source = Source();\n  var sink = pull.collect(function (err, ary) {\n    if (err) {\n      return source.abort(err);\n    }\n\n    sorter(ary, function (err, res) {\n      if (err) {\n        return source.abort(err);\n      }\n\n      source.resolve(pull.values(ary));\n    });\n  });\n  return function (read) {\n    sink(read);\n    return source;\n  };\n};\n\nexports.replaceStartWith = function (s, r) {\n  var matcher = new RegExp('^' + r);\n  return s.replace(matcher, '');\n};\n\nexports.tmpdir = function () {\n  return path.join(os.tmpdir(), uuid());\n};","map":null,"metadata":{},"sourceType":"script"}