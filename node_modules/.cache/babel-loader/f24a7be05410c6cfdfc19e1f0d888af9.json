{"ast":null,"code":"'use strict';\n\nvar inherits = require('inherits');\n\nvar Provider = require('./provider.js');\n\nvar utils = function () {\n  return {\n    defineProperty: require('../utils/properties.js').defineProperty\n  };\n}();\n\nfunction FallbackProvider(providers) {\n  if (providers.length === 0) {\n    throw new Error('no providers');\n  }\n\n  var network = {};\n  ['chainId', 'ensAddress', 'name', 'testnet'].forEach(function (key) {\n    for (var i = 1; i < providers.length; i++) {\n      if (providers[0][key] !== providers[i][key]) {\n        throw new Error('incompatible providers - ' + key + ' mismatch');\n      }\n    }\n\n    network[key] = providers[0][key];\n  });\n\n  if (!(this instanceof FallbackProvider)) {\n    throw new Error('missing new');\n  }\n\n  Provider.call(this, network);\n  providers = providers.slice(0);\n  Object.defineProperty(this, 'providers', {\n    get: function get() {\n      return providers.slice(0);\n    }\n  });\n}\n\ninherits(FallbackProvider, Provider);\nutils.defineProperty(FallbackProvider.prototype, 'perform', function (method, params) {\n  var providers = this.providers;\n  return new Promise(function (resolve, reject) {\n    var firstError = null;\n\n    function next() {\n      if (!providers.length) {\n        reject(firstError);\n        return;\n      }\n\n      var provider = providers.shift();\n      provider.perform(method, params).then(function (result) {\n        return resolve(result);\n      }, function (error) {\n        if (!firstError) {\n          firstError = error;\n        }\n\n        next();\n      }).catch(function (error) {});\n    }\n\n    next();\n  });\n});\nmodule.exports = FallbackProvider;","map":null,"metadata":{},"sourceType":"script"}