{"ast":null,"code":"var ethUtil = require('ethereumjs-util');\n\nvar rlp = require('rlp');\n\nvar Buffer = require('safe-buffer').Buffer;\n\nvar Account = module.exports = function (data) {\n  // Define Properties\n  var fields = [{\n    name: 'nonce',\n    default: Buffer.alloc(0)\n  }, {\n    name: 'balance',\n    default: Buffer.alloc(0)\n  }, {\n    name: 'stateRoot',\n    length: 32,\n    default: ethUtil.SHA3_RLP\n  }, {\n    name: 'codeHash',\n    length: 32,\n    default: ethUtil.SHA3_NULL\n  }];\n  ethUtil.defineProperties(this, fields, data);\n};\n\nAccount.prototype.serialize = function () {\n  return rlp.encode(this.raw);\n};\n\nAccount.prototype.isContract = function () {\n  return this.codeHash.toString('hex') !== ethUtil.SHA3_NULL_S;\n};\n\nAccount.prototype.getCode = function (state, cb) {\n  if (!this.isContract()) {\n    cb(null, Buffer.alloc(0));\n    return;\n  }\n\n  state.getRaw(this.codeHash, cb);\n};\n\nAccount.prototype.setCode = function (trie, code, cb) {\n  var self = this;\n  this.codeHash = ethUtil.sha3(code);\n\n  if (this.codeHash.toString('hex') === ethUtil.SHA3_NULL_S) {\n    cb(null, Buffer.alloc(0));\n    return;\n  }\n\n  trie.putRaw(this.codeHash, code, function (err) {\n    cb(err, self.codeHash);\n  });\n};\n\nAccount.prototype.getStorage = function (trie, key, cb) {\n  var t = trie.copy();\n  t.root = this.stateRoot;\n  t.get(key, cb);\n};\n\nAccount.prototype.setStorage = function (trie, key, val, cb) {\n  var self = this;\n  var t = trie.copy();\n  t.root = self.stateRoot;\n  t.put(key, val, function (err) {\n    if (err) return cb();\n    self.stateRoot = t.root;\n    cb();\n  });\n};\n\nAccount.prototype.isEmpty = function () {\n  return this.balance.toString('hex') === '' && this.nonce.toString('hex') === '' && this.stateRoot.toString('hex') === ethUtil.SHA3_RLP_S && this.codeHash.toString('hex') === ethUtil.SHA3_NULL_S;\n};","map":null,"metadata":{},"sourceType":"script"}