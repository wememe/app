{"ast":null,"code":"'use strict';\n\nvar toStream = require('pull-stream-to-stream');\n\nvar MplexCore = require('./internals');\n\nvar MULTIPLEX_CODEC = require('./codec');\n\nvar Muxer = require('./muxer');\n\nvar pump = require('pump');\n\nfunction create(rawConn, isListener) {\n  var stream = toStream(rawConn); // Cleanup and destroy the connection when it ends as the converted stream\n  // doesn't emit 'close' but .destroy will trigger a 'close' event.\n\n  stream.on('end', function () {\n    return stream.destroy();\n  });\n  var mpx = new MplexCore({\n    halfOpen: true,\n    initiator: !isListener\n  });\n  pump(stream, mpx, stream);\n  return new Muxer(rawConn, mpx);\n}\n\nexports = module.exports = create;\nexports.multicodec = MULTIPLEX_CODEC;\n\nexports.dialer = function (conn) {\n  return create(conn, false);\n};\n\nexports.listener = function (conn) {\n  return create(conn, true);\n};","map":null,"metadata":{},"sourceType":"script"}