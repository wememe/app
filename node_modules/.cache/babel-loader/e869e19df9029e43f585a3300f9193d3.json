{"ast":null,"code":"'use strict';\n\nvar pull = require('pull-stream/pull');\n\nvar values = require('pull-stream/sources/values');\n\nvar lp = require('pull-length-prefixed');\n\nvar msg = require('./message');\n\nmodule.exports = function (conn, pInfoSelf) {\n  // send what I see from the other + my Info\n  conn.getObservedAddrs(function (err, observedAddrs) {\n    if (err) {\n      return;\n    }\n\n    observedAddrs = observedAddrs[0];\n    var publicKey = Buffer.alloc(0);\n\n    if (pInfoSelf.id.pubKey) {\n      publicKey = pInfoSelf.id.pubKey.bytes;\n    }\n\n    var msgSend = msg.encode({\n      protocolVersion: 'ipfs/0.1.0',\n      agentVersion: 'na',\n      publicKey: publicKey,\n      listenAddrs: pInfoSelf.multiaddrs.toArray().map(function (ma) {\n        return ma.buffer;\n      }),\n      observedAddr: observedAddrs ? observedAddrs.buffer : Buffer.from('')\n    });\n    pull(values([msgSend]), lp.encode(), conn);\n  });\n};","map":null,"metadata":{},"sourceType":"script"}